import{_ as V,M as E,r as v,o,c as d,e as w,d as t,F as c,j as u,t as n,k as L,G as D}from"./index-217795b9.js";import{p as A}from"./PaginationView-e0d7ad63.js";const{VITE_URL:_,VITE_PATH:h}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"koung-hexschool",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let x=null;const P={props:["checkAdmin"],data(){return{orders:[],tempOrder:{},page:{},isLoading:!1}},components:{pagination:A},methods:{getOrders(a=1){this.isLoading=!0,this.$http.get(`${_}/v2/api/${h}/admin/orders?page=${a}`).then(l=>{this.orders=l.data.orders,this.page=l.data.pagination,this.isLoading=!1,console.log(l.data.orders)}).catch(l=>{this.isLoading=!0,alert(l.response.data.message)})},openOrderModal(a){this.tempOrder={...a},x.show()},updatePaid(a){this.isLoading=!0,this.$http.put(`${_}/v2/api/${h}/admin/order/${a.id}`,{data:{is_paid:a.is_paid}}).then(l=>{alert(l.data.message),this.getOrders(),this.isLoading=!1}).catch(l=>{this.isLoading=!1,alert(l.response)})},deleteOrder(a){this.isLoading=!0,this.$http.delete(`${_}/v2/api/${h}/admin/order/${a.id}`).then(l=>{this.isLoading=!1,alert(l.data.message),location.reload()}).catch(l=>{this.isLoading=!0,alert(l.response.data.message)})}},mounted(){this.checkAdmin(),this.getOrders(),x=new E(document.getElementById("orderModal"))}},S=t("h3",{class:"fw-bold"},"後台訂單列表",-1),T={key:0},U=t("p",null,"目前尚未有訂單",-1),$=[U],B={key:1,class:"table table-striped mt-5"},I=t("thead",null,[t("tr",null,[t("th",null,"訂單時間"),t("th",null,"Email"),t("th",null,"購買品項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),R={class:"form-check form-switch"},F=["id","onUpdate:modelValue","onChange"],H=["for"],j={key:0},q={key:1},N={class:"btn-group"},Y=["onClick"],z=["onClick"],G={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},J={class:"modal-dialog modal-xl"},K={class:"modal-content"},Q=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"orderModalLabel"},"訂單資訊"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),W={class:"modal-body"},X={class:"row"},Z={class:"col"},tt=t("h3",{class:"fw-bold"},"用戶資料",-1),et=t("th",null,"姓名",-1),st=t("th",null,"Email",-1),lt=t("th",null,"地址",-1),nt=t("th",null,"電話",-1),ot={class:"col"},dt=t("h3",{class:"fw-bold"},"訂單資訊",-1),at=t("th",null,"訂單編號",-1),it=t("th",null,"訂單時間",-1),rt=t("th",null,"付款狀態",-1),ct={key:0,class:"fw-bold text-primary"},ut={key:1,class:"fw-bold text-danger"},_t=t("th",null,"總金額",-1),ht=t("h3",{class:"fw-bold"},"購買品項",-1),pt={class:"text-end"},mt={class:"d-flex justify-content-end"},gt={class:"form-check"},bt={class:"form-check-label",for:"paidCheck"},ft={key:0},kt={key:1},yt={class:"modal-footer"},Ot=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function vt(a,l,wt,Lt,s,r){var p,m,g,b,f,k,y,O;const M=v("VueLoading"),C=v("pagination");return o(),d(c,null,[w(M,{active:s.isLoading,"z-index":1060},null,8,["active"]),S,s.orders.length===0?(o(),d("div",T,$)):(o(),d("table",B,[I,t("tbody",null,[(o(!0),d(c,null,u(s.orders,e=>(o(),d("tr",{key:e.id},[t("td",null,n(`${new Date(e.create_at*1e3).getFullYear()}-${new Date(e.create_at*1e3).getMonth()+1}-${new Date(e.create_at*1e3).getDate()} ${new Date(e.create_at*1e3).getHours()} : ${new Date(e.create_at*1e3).getMinutes()}`),1),t("td",null,n(e.user.email),1),t("td",null,[(o(!0),d(c,null,u(e.products,i=>(o(),d("p",{key:i.products},n(i.product.title)+" (數量 : "+n(i.qty)+" "+n(i.product.unit)+") ",1))),128))]),t("td",null,n(e.total),1),t("td",null,[t("div",R,[L(t("input",{class:"form-check-input",type:"checkbox",id:`paidState${e.id}`,"onUpdate:modelValue":i=>e.is_paid=i,onChange:i=>r.updatePaid(e)},null,40,F),[[D,e.is_paid]]),t("label",{class:"form-check-label",for:`paidState${e.id}`},[e.is_paid?(o(),d("span",j,"已付款")):(o(),d("span",q,"未付款"))],8,H)])]),t("td",null,[t("div",N,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:i=>r.openOrderModal(e)}," 檢視 ",8,Y),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>r.deleteOrder(e)}," 刪除 ",8,z)])])]))),128))])])),w(C,{pages:s.page,"get-products":r.getOrders},null,8,["pages","get-products"]),t("div",G,[t("div",J,[t("div",K,[Q,t("div",W,[t("div",X,[t("div",Z,[tt,t("table",null,[t("tbody",null,[t("tr",null,[et,t("td",null,n((m=(p=s.tempOrder)==null?void 0:p.user)==null?void 0:m.name),1)]),t("tr",null,[st,t("td",null,n((b=(g=s.tempOrder)==null?void 0:g.user)==null?void 0:b.email),1)]),t("tr",null,[lt,t("td",null,n((k=(f=s.tempOrder)==null?void 0:f.user)==null?void 0:k.address),1)]),t("tr",null,[nt,t("td",null,n((O=(y=s.tempOrder)==null?void 0:y.user)==null?void 0:O.tel),1)])])])]),t("div",ot,[dt,t("table",null,[t("tbody",null,[t("tr",null,[at,t("td",null,n(s.tempOrder.id),1)]),t("tr",null,[it,t("td",null,n(`${new Date(s.tempOrder.create_at*1e3).getFullYear()}-${new Date(s.tempOrder.create_at*1e3).getMonth()+1}-${new Date(s.tempOrder.create_at*1e3).getDate()} ${new Date(s.tempOrder.create_at*1e3).getHours()} : ${new Date(s.tempOrder.create_at*1e3).getMinutes()}`),1)]),t("tr",null,[rt,t("td",null,[s.tempOrder.is_paid?(o(),d("span",ct,"已付款")):(o(),d("span",ut,"未付款"))])]),t("tr",null,[_t,t("td",null,n(s.tempOrder.total),1)])])]),ht,t("table",null,[t("tbody",null,[(o(!0),d(c,null,u(s.tempOrder.products,e=>(o(),d("tr",{key:e.id},[t("th",null,n(e.product.title),1),t("td",null,n(e.qty)+" / "+n(e.product.unit),1),t("td",pt,n(e.final_total),1)]))),128))])]),t("div",mt,[t("div",gt,[L(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"paidCheck","onUpdate:modelValue":l[0]||(l[0]=e=>s.tempOrder.is_paid=e)},null,512),[[D,s.tempOrder.is_paid]]),t("label",bt,[s.tempOrder.is_paid?(o(),d("span",ft,"已付款")):(o(),d("span",kt,"未付款"))])])])])])]),t("div",yt,[Ot,t("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=e=>r.updatePaid(s.tempOrder))}," 修改付款狀態 ")])])])])],64)}const Mt=V(P,[["render",vt]]);export{Mt as default};
